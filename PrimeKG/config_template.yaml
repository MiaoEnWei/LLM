# RAG Framework 配置文件
# 用法：python pubmed_rag_pipeline.py --config config.yaml

#  
# API 配置
#  
api:
  provider: "openai"  # openai / azure / custom
  api_key: "${OPENAI_API_KEY}"  # 环境变量或直接设置
  base_url: "https://api.openai.com/v1"
  model_name: "gpt-3.5-turbo"
  temperature: 0.0
  max_retries: 3
  timeout: 30  # 秒

#  
# 检索模块配置
#  
retrieval:
  # Dense 检索（PubMedBERT）
  dense:
    enabled: true
    model_name: "microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract"
    device: "cuda"  # cuda / cpu
    batch_size: 32
    max_length: 512
    embedding_cache: "pubmed_embeddings.pkl"  # 缓存路径
  
  # Sparse 检索（BM25）
  sparse:
    enabled: true
    tokenizer: "simple"  # simple / nltk / spacy
  
  # Reranking
  reranker:
    enabled: true
    model_name: "cross-encoder/ms-marco-MiniLM-L-6-v2"
    device: "cuda"
  
  # 混合检索参数
  hybrid:
    alpha: 0.5  # Dense 权重，(1-alpha) 为 BM25
    k_dense: 10
    k_bm25: 10
    k_final: 5

#  
# RAG 配置
#  
rag:
  max_context_length: 2000  # 上下文最大字符数
  context_format: "passages"  # passages / chunks / hierarchical
  prompt_template: "default"  # default / medical / qa
  few_shot_examples: 0  # 0 / 3 / 5（few-shot 示例数）

#  
# 数据配置
#  
data:
  # 输入
  dataset_type: "medmcqa"  # medmcqa / pubmedqa / bioasq / custom
  dataset_file: "data/medmcqa/dev.json"
  start_idx: 0
  end_idx: 1000
  
  # 语料库
  corpus_file: null  # 自定义语料库文件路径
  corpus_type: "passages"  # passages / documents / abstracts
  passage_length: "250-300"  # tokens，用于切分
  
  # 输出
  output_dir: "rag_results"
  save_format: "jsonl"  # jsonl / csv / parquet
  save_freq: 100  # 每 N 个样本保存一次

#  
# 评测配置
#  
evaluation:
  metrics:
    retrieval:
      - "recall_at_5"
      - "recall_at_10"
      - "mrr"
      - "ndcg_at_5"
    
    generation:
      - "exact_match"
      - "f1"
      - "rouge_l"
      - "rouge_1"
  
  # 错误分析
  error_analysis:
    enabled: true
    num_examples: 5
    save_to_file: true
  
  # 混淆矩阵
  confusion_matrix:
    enabled: true
    save_plot: true

#  
# 优化参数
#  
optimization:
  # 缓存
  cache:
    embeddings: true
    bm25_index: true
    faiss_index: true
  
  # 批处理
  batch_size: 32
  num_workers: 4
  
  # 量化（大规模数据）
  quantization:
    enabled: false
    type: "int8"  # int8 / float16 / product
  
  # 索引优化
  index_type: "flat"  # flat / ivf / ivf_pq

#  
# 日志与调试
#  
logging:
  level: "INFO"  # DEBUG / INFO / WARNING / ERROR
  save_to_file: true
  log_file: "rag.log"
  
  # 详细输出
  verbose: false
  print_samples: false  # 打印示例结果

#  
# 硬件与资源
#  
resources:
  device: "cuda"  # cuda / cpu
  gpu_id: 0  # 使用第几块 GPU
  max_memory_gb: 16  # 最大 GPU 内存限制
  num_threads: 8  # CPU 线程数

#  
# 实验跟踪（可选）
#  
tracking:
  enabled: false
  experiment_name: "pubmedbert_rag_v1"
  tags: ["medical_qa", "pubmedqa"]
  
  # Weights & Biases 集成
  wandb:
    enabled: false
    project: "medical-qa"
    entity: "your-username"
